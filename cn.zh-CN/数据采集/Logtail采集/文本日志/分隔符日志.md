# 分隔符日志 {#reference_p3p_h55_vdb .task}

日志服务支持通过控制台数据接入向导一站式配置分隔符模式采集日志与设置索引。

分隔符日志以换行符作为边界，每一个自然行都是一条日志。每一条日志以固定分隔符连接日志的多个字段，分隔符（Separator）包括制表符、空格、竖线、逗号、分号等单字符。如果字段内部包含分隔符，使用双引号作为引用符（Quote）对字段进行包裹。

本章节主要为您介绍分分隔符日志采集的Logtail配置部分，关于其他采集步骤的详细说明请参见[文本日志采集流程](cn.zh-CN/数据采集/Logtail采集/文本日志/文本日志采集流程.md#)。

## 日志介绍 {#section_4ny_a55_tle .section}

常见的分隔符日志有：CSV、TSV 等。

分隔符日志使用分隔符（Separator）将一条日志切分成多个字段，支持**单字符**和**多字符**两种模式。

## 单字符模式 {#section_rr3_o7z_600 .section}

单字符模式中，您需要指定分隔符，也可以同时指定引用符。

-   **分隔符**：日志字段通过单字符的分隔符进行切分，例如制表符（`\t`）、竖线（`|`）、空格、逗号（`,`）、分号（`;`）和不可见字符等单字符。

    **说明：** 分隔符不支持设置为双引号（`"`）。

    如果双引号作为日志内容，而不是引用符（Quote）出现在日志中，则需要进行转义，日志中应处理为`""`。日志服务解析字段时会自动还原，即将`""`还原为`"`。双引号（`"`）可以作为Quote，在字段的边界单次出现；也可以作为字段内容成对出现（即转义为`""`），其它情况不符合分隔符日志的格式定义，请考虑极简模式、正则模式等其它方式进行字段解析。

    例如，逗号作为分隔符，双引号和逗号作为日志字段中的一部分，需要将包含逗号分隔符的日志字段用Quote包裹，同时将日志字段中的双引号转义为成对的双引号`""`。处理后的日志格式为：`1999,Chevy,"Venture ""Extended Edition, Very Large""","",5000.00`。该日志可以被解析为五个字段： `1999`、`Chevy`、`Venture "Extended Edition, Very Large"`、空字段和`5000.00`。

-   **引用符**：日志字段内容中包含分隔符时，为避免日志字段被误分割，需要指定引用符（Quote）对内部包含分隔符的日志字段进行包裹隔离。被引用符包裹的内容会被日志服务解析为一个完整字段，字段之间只能存在分隔符。

    引用符可以设置为制表符（`\t`）、竖线（`|`）、空格、逗号（`,`）、分号（`;`）和不可见字符等单字符。

    例如，逗号（`,`）作为分隔符，双引号作为Quote时，日志格式为：`1997,Ford,E350,"ac, abs, moon",3000.00`。该日志可以被解析为5个字段： `1997`、`Ford`、`E350`、`ac, abs, moon`和`3000.00`。其中被Quote包裹的`ac, abs, moon`被看做是一个完整字段。


**说明：** 日志服务支持将分隔符和引用符设置为不可见字符。不可见字符是ASCII码中编号为1~31及127的字符，指定分隔符和引用符为不可见字符时，您需要查找不可见字符在ASCII码中对应的十六进制数，输入的格式为`0x不可见字符在ASCII码中对应的十六进制数`。例如ASCII码中排行为1的不可见字符填写为`0x01`。

![分隔符日志](http://static-aliyun-doc.oss-cn-hangzhou.aliyuncs.com/assets/img/13046/156877821821597_zh-CN.png)

## 多字符模式 {#section_gqj_ndn_5t2 .section}

**多字符模式**中，分隔符可以包括2~3个字符，如（`||`）、（`&&&`）、（`^_^`）等多字符。多字符分隔符模式下，日志解析完全根据分隔符进行匹配，您无需使用引用符（Quote）对日志进行包裹。

**说明：** 需确保日志字段内容中不会出现分隔符的完整匹配，否则会产生字段误分割。

例如，分隔符设置为`&&`的情况下，日志：`1997&&Ford&&E350&&ac&abs&moon&&3000.00`会被解析为5个字段：`1997`、`Ford`、`E350`、`ac&abs&moon`和`3000.00`。

## 日志示例 {#section_pfd_f5w_x0n .section}

-   **单字符分隔符日志** 

    ``` {#codeblock_xli_cvr_cua}
    05/May/2016:13:30:28,10.10.*.*,"POST /PutData?Category=YunOsAccountOpLog&AccessKeyId=****************&Date=Fri%2C%2028%20Jun%202013%2006%3A53%3A30%20GMT&Topic=raw&Signature=******************************** HTTP/1.1",200,18204,aliyun-sdk-java
    05/May/2016:13:31:23,10.10.*.*,"POST /PutData?Category=YunOsAccountOpLog&AccessKeyId=****************&Date=Fri%2C%2028%20Jun%202013%2006%3A53%3A30%20GMT&Topic=raw&Signature=******************************** HTTP/1.1",401,23472,aliyun-sdk-java
    ```

-   **多字符分隔符日志** 

    ``` {#codeblock_acc_n3d_rcs}
    05/May/2016:13:30:28&&10.200.**.**&&POST /PutData?Category=YunOsAccountOpLog&AccessKeyId=****************&Date=Fri%2C%2028%20Jun%202013%2006%3A53%3A30%20GMT&Topic=raw&Signature=pD12XYLmGxKQ%2Bmkd6x7hAgQ7b1c%3D HTTP/1.1&&200&&18204&&aliyun-sdk-java
    05/May/2016:13:31:23&&10.200.**.**&&POST /PutData?Category=YunOsAccountOpLog&AccessKeyId=****************&Date=Fri%2C%2028%20Jun%202013%2006%3A53%3A30%20GMT&Topic=raw&Signature=******************************** HTTP/1.1&&401&&23472&&aliyun-sdk-java
    ```


## 采集步骤 {#section_rqs_sz2_v36 .section}

1.  登录[日志服务控制台](https://sls.console.aliyun.com)。
2.  选择数据源类型。 采集分隔符日志请选择**分隔符-文本日志**。
3.  选择日志空间。 请选择Project和Logstore，您也可以直接单击**立即创建**新建Project和Logstore。具体步骤请参见[准备流程](../../../../cn.zh-CN/准备工作/准备流程.md#)。

    如果您是通过日志库下的**数据接入**后的加号进入采集配置流程，系统会直接跳过该步骤。

4.  创建机器组。 在创建机器组之前，您需要首先确认已经安装了Logtail。

    -   ECS机器： Linux系统勾选实例后单击**安装**进行一键式安装。Windows系统不支持一键式安装，请参见[安装Logtail（Windows系统）](../../../../cn.zh-CN/数据采集/Logtail采集/安装/安装Logtail（Windows系统）.md#)手动安装。
    -   自建（非ECS）机器：请根据界面提示进行安装。或者请参见[安装Logtail（Linux系统）](cn.zh-CN/数据采集/Logtail采集/安装/安装Logtail（Linux系统）.md#)或[安装Logtail（Windows系统）](cn.zh-CN/数据采集/Logtail采集/安装/安装Logtail（Windows系统）.md#)进行安装。
    安装完Logtail后单击**确认安装完毕**创建机器组，具体请参见[简介](../../../../cn.zh-CN/数据采集/Logtail采集/机器组/简介.md#)。如果您之前已经创建好机器组 ，请直接单击**使用现有机器组**。

5.  机器组配置。 选择一个机器组，将该机器组从**源机器组**移动到**应用机器组**。

    ![机器组配置](http://static-aliyun-doc.oss-cn-hangzhou.aliyuncs.com/assets/img/13062/156877821860275_zh-CN.png)

6.  Logtail配置。 分隔符日志采集配置的Logtail配置项说明如下。

    |配置项|详情|
    |---|--|
    |配置名称|配置名称只能包含小写字母、数字、连字符（-）和下划线（\_），且必须以小写字母和数字开头和结尾，长度为3~128字符。 **说明：** 配置名称设置后不可修改。

 |
    |日志路径|指定日志的目录和文件名。     -   日志文件名支持完整文件名和通配符两种模式，文件名规则请参见[Wildcard matching](http://man7.org/linux/man-pages/man7/glob.7.html)。
    -   日志文件查找模式为多层目录匹配，即指定文件夹下所有符合文件名模式的文件都会被监控到，包含所有层次的目录。

        -   例如`/apsara/nuwa/ … /*.log`表示`/apsara/nuwa`目录中（包含该目录的递归子目录）后缀名为`.log`的文件。
        -   例如`/var/logs/app_* … /*.log*`表示`/var/logs`目录下所有符合`app_*`模式的目录中（包含该目录的递归子目录）文件名包含`.log`的文件。
**说明：** 

        -   一个文件只能被一个配置收集。
        -   目录通配符只支持 `*`和`?` 两种。
 |
    |是否为Docker文件|如果是Docker容器内部文件，可以直接配置内部路径与容器Tag，Logtail会自动监测容器创建和销毁，并根据Tag进行过滤采集指定容器的日志。|
    |模式|之前步骤我们选择的数据源是**分隔符-文本日志**，所以这里默认是**分隔符模式**，您也可以手动修改。|
    |日志样例|请务必使用实际场景的日志，方便日志服务控制台自动提取其中的正则匹配模式。|
    |分隔符|选择分隔符。 请根据您的日志格式选择正确的分隔符否则日志数据会解析失败。

**说明：** 指定分隔符为不可见字符时，您需要查找不可见字符在ASCII码中对应的十六进制数，输入的格式为`0x不可见字符在ASCII码中对应的十六进制数`。例如ASCII码中排行为1的不可见字符填写为`0x01`。

 |
    |引用符|选择引用符。 请根据您的日志格式选择正确的引用符，否则日志数据会解析失败。

**说明：** 指定引用符为不可见字符时，您需要查找不可见字符在ASCII码中对应的十六进制数，输入的格式为`0x不可见字符在ASCII码中对应的十六进制数`。例如ASCII码中排行为1的不可见字符填写为`0x01`。

 |
    |日志抽取内容|填写日志样例并选择分隔符后，日志服务会按照您选择的分隔符提取日志字段，并将其定义为Value，您需要分别为Value指定对应的Key。|
    |是否接受部分字段|配置采集后，若日志中分割出的字段数少于配置的Key数量，是否上传已解析的字段。开启表示上传，关闭表示丢弃本条日志。 例如，在配置采集分隔符日志时，示例日志为`11|22|33|44|55`，设置分隔符为`|`，日志字段会被解析为`11`、`22`、`33`、`44`和`55`，为其分别设置Key为`A`、`B`、`C`、`D`和`E`。如果配置采集时开启了**接受部分字段**，采集日志`11|22|33|55`时，`55`字段会作为Key`D`的Value被上传到日志服务。如果配置采集时关闭了**接受部分字段**，该条日志会因字段与Key不匹配而被丢弃。

 |
    |使用系统时间|当打开提取字段开关时，需要设置。 如果关闭，您需要在提取字段时指定某一字段（Value）为时间字段，并命名为 `time`。在选取 `time` 字段后，您可以单击**时间转换格式**中的**自动生成** 生成解析该时间字段的方式。关于日志时间格式的更多信息请参见[配置时间格式](../../../../cn.zh-CN/数据采集/Logtail采集/文本日志/配置时间格式.md#)。

 |
    |丢弃解析失败日志|请选择解析失败的日志是否上传到日志服务。     -   开启后，解析失败的日志不会上传到日志服务。
    -   关闭后，日志解析失败时上传原始日志。
 |
    |最大监控目录深度|指定从日志源采集日志时，监控目录的最大深度，即最多监控几层日志。最大目录监控深度范围0-1000，0代表只监控本层目录。|

    ![分隔符采集配置](http://static-aliyun-doc.oss-cn-hangzhou.aliyuncs.com/assets/img/13046/156877821860713_zh-CN.png)

7.  配置**高级选项**，设置完成后，单击**下一步**。 请根据您的需求选择高级配置。如没有特殊需求，建议保持默认配置。

    |配置项|详情|
    |:--|:-|
    |上传原始日志|请选择是否需要上传原始日志。开启该功能后，原始日志内容会作为\_\_raw\_\_字段与解析过的日志一并上传。|
    |Topic生成方式|     -   **空-不生成Topic**：默认选项，表示设置Topic为空字符串，在查询日志时不需要输入Topic即可查询。
    -   **机器组Topic属性**：设置Topic生成方式为机器组Topic属性，可以用于明确区分不同前端服务器产生的日志数据。
    -   **文件路径正则**：选择此项之后，您需要填写下方的**自定义正则**，用正则式从路径里提取一部分内容作为Topic。可以用于区分具体用户或实例产生的日志数据。
 |
    |自定义正则|如您选择了**文件路径正则**方式生成Topic，需要在此处填写您的自定义正则式。|
    |日志文件编码|     -   utf8：指定使用UTF-8编码。
    -   gbk：指定使用GBK编码。
 |
    |时区属性|设置采集日志时，日志时间的时区属性。     -   机器时区：默认为机器所在时区。
    -   自定义时区：手动选择时区。
 |
    |超时属性|如果一个日志文件在指定时间内没有任何更新，则认为该文件已超时。您可以对**超时属性**指定以下配置。     -   永不超时：指定持续监控所有日志文件，永不超时。
    -   30分钟超时：如日志文件在30分钟内没有更新，则认为已超时，并不再监控该文件。
 |
    |过滤器配置|日志只有**完全符合**过滤器中的条件才会被收集。 例如：

    -   **满足条件即收集**：配置`Key:level Regex:WARNING|ERROR`，表示只收集level为WARNING或ERROR类型的日志。
    -   [过滤不符合条件的数据](http://www.regular-expressions.info/lookaround.html)：
        -   配置`Key:level Regex:^(?!.*(INFO|DEBUG)).*`，表示不收集level为INFO或DEBUG类型的日志。
        -   配置`Key:url Regex:.*^(?!.*(healthcheck)).*`，表示不采集url中带有healthcheck的日志，例如key为url，value为`/inner/healthcheck/jiankong.html`的日志将不会被采集。
更多示例可参见[regex-exclude-word](https://stackoverflow.com/questions/2404010/match-everything-except-for-specified-strings)、[regex-exclude-pattern](https://stackoverflow.com/questions/2078915/a-regular-expression-to-exclude-a-word-string)。

 |

8.  查询分析配置。 默认已经设置好索引，您也可以根据业务需求，重新设置索引。具体请参见[开启并配置索引](../../../../cn.zh-CN/查询与分析/开启并配置索引.md#)。

配置完成后您就可以开始采集分隔符日志。

