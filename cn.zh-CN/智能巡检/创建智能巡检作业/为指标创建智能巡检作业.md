# 为指标创建智能巡检作业

日志服务提供智能巡检功能，可用于对监控指标进行自动化、智能化、自适应的异常巡检。本文以某公司的服务器监控指标日志为例，说明如何创建智能巡检作业，从而对机器运行状态进行监控与告警。

-   已采集日志到源Logstore。具体操作，请参见[数据采集概述](/cn.zh-CN/数据采集/数据采集概述.md)。
-   已配置源Logstore的索引。具体操作，请参见[配置索引](/cn.zh-CN/查询与分析/配置索引.md)。

## 操作步骤

1.  登录[日志服务控制台](https://sls.console.aliyun.com)。

2.  在Project列表区域，单击目标Project。

3.  在左侧导航栏中，选择**作业** \> **智能巡检**。

4.  如果您是首次配置智能巡检作业，根据页面提示完成授权操作。

    **说明：**

    -   巡检事件会统一写入名称为internal-ml-log的Logstore中，您需要授予日志服务使用阿里云系统角色AliyunLogETLRole执行该操作的权限。
    -   授权操作仅在首次配置时需要，且需由目标Project所属的阿里云账户完成。
5.  在**智能巡检**区域右侧，单击![plus](https://static-aliyun-doc.oss-accelerate.aliyuncs.com/assets/img/zh-CN/4240452261/p279288.png)图标。

6.  在**创建智能巡检作业**配置向导页面的**基本信息**区域，完成以下配置，然后单击**下一步**。

    |参数|说明|
    |--|--|
    |作业名称|智能巡检作业的名称。|
    |源日志库|用于存储源数据的Logstore名称。|

7.  在**创建智能巡检作业**配置向导页面的**算法配置**区域，完成以下操作。

    1.  在**数据特征配置**区域的**数据类型**，选择**指标化数据**，然后完成以下配置。

        ![metric](https://static-aliyun-doc.oss-accelerate.aliyuncs.com/assets/img/zh-CN/1605162261/p279396.png)

        |参数|说明|
        |--|--|
        |时间|源数据中用于标识时间列的字段。日志服务默认使用源Logstore中的`_time_`字段。|
        |粒度|数据的观测间隔。单位为秒。取值范围为5~3600。|
        |实体|源数据中用于标识具体实体的字段。智能巡检作业围绕实体标识聚合出时间序列。|
        |特征|源数据中用于标识具体特征数据的字段。您可设定取值的下（左）上（右）界。如果您不确定特征项的取值范围，您可以不设置该字段。|

    2.  在**算法配置**区域，完成以下配置，然后在**数据采样**中，选择一个实体，单击**预览采样数据**，验证您所配置的参数与您的数据是否适配，以及执行结果是否符合您的预期。

        ![algorithm_metric](https://static-aliyun-doc.oss-accelerate.aliyuncs.com/assets/img/zh-CN/3329862261/p279407.png)

        |参数|说明|
        |--|--|
        |算法选择|异常检测算法。默认为**流式图算法**。|
        |时序分段个数|对时序数值进行划分，用于离散化时间序列，构造时序演化图，降低噪音的影响。        -   默认值为5。
        -   建议值范围为\[5,20\]。
        -   分段越少，对噪音越不敏感。 |
        |观测长度|数据的观测间隔。        -   默认值为2880。
        -   建议值范围为\[200,4000\]。
        -   建议取值涵盖2个周期。例如，某个时间序列的观测点时间间隔为1分钟、周期为1天，则该时间序列2个周期有2880个观测点，建议观测长度的取值大于等于2880。 |
        |敏感度|异常分数输出的敏感度。        -   默认异常分数大于0.5表示异常。
        -   敏感度设置越高，模型量化每个异常点的分数越高。 |

    3.  在**调度配置**区域，设置智能巡检作业开始执行的时间位置。

        **说明：** 智能巡检作业默认从设置的位置开始一直往后执行。

    4.  单击**下一步**。

8.  在**创建智能巡检作业**配置向导页面的**告警配置**区域，完成以下配置，然后单击**完成**。

    |参数|说明|
    |--|--|
    |告警策略|告警策略用于合并、静默和抑制已产生的告警。    -   选择**极简模式**和**普通模式**时，您无需配置告警策略。日志服务默认使用SLS内置动态告警策略（sls.builtin.dynamic）进行告警管理。
    -   选择**高级模式**时，您可以选择内置的或自定义的告警策略进行告警管理。如何创建告警策略，请参见[创建告警策略](/cn.zh-CN/告警/告警（新版）/告警管理/创建告警策略.md)。 |
    |行动策略|行动策略用于控制告警通知渠道和频率等。    -   当**告警策略**选择为**极简模式**时，您只需配置行动组即可。

您配置行动组后，日志服务自动为您创建一个名为`规则名称-行动策略`的行动策略。由该告警监控规则触发的所有告警都通过该行动策略发送通知。如何配置，请参见[通知渠道说明](/cn.zh-CN/告警/告警（新版）/通知管理/通知渠道/通知渠道说明.md)。

**说明：** 您可以在行动策略管理页面，修改该行动策略。具体操作，请参见[创建行动策略](/cn.zh-CN/告警/告警（新版）/通知管理/创建行动策略.md)。如果您在修改行动策略时添加了判断条件，则此处的**告警策略**将自动变更为**普通模式**。

    -   当**告警策略**选择为**普通模式**或**高级模式**时，您可以选择内置的或自定义的行动策略进行告警通知。如何创建行动策略，请参见[创建行动策略](/cn.zh-CN/告警/告警（新版）/通知管理/创建行动策略.md)。

其中，您选择**告警策略**选择为**高级模式**时，还可以开启或关闭**自定义行动策略**。更多信息，请参见[动态行动策略机制](/cn.zh-CN/告警/告警（新版）/告警管理/告警降噪控制/动态行动策略机制.md)。 |
    |重复等待|在重复等待时间内，重复的告警只触发一次行动策略，即只发送一次告警通知。|


## 执行结果

创建智能巡检作业后，**智能巡检**页面显示您创建的智能巡检作业的基础信息。

![metric_task](https://static-aliyun-doc.oss-accelerate.aliyuncs.com/assets/img/zh-CN/2605162261/p279324.png)

等待一段时间后，**智能巡检**页面显示您创建的智能巡检作业的巡检结果等信息。

![metric_result](https://static-aliyun-doc.oss-accelerate.aliyuncs.com/assets/img/zh-CN/2605162261/p279325.png)

## 相关操作

创建智能巡检作业后，您可以在**智能巡检**页面修改或删除智能巡检作业。

**说明：** 智能巡检作业被删除后，不可恢复，请您谨慎操作。

