# 配置告警

SLB日志中心为您提供告警和通知功能。当日志数据满足某些条件时，您会收到告警通知，有助于及时发现SLB日志中心异常问题。本文以自定义创建告警实例为例，介绍如何配置告警。

日志中心预设了基线告警、同环比告警、智能告警等告警策略，包含QPS、延迟、错误率、流量等，并支持短信、钉钉、邮件、语音、自定义Webhook等通知方式，您可以根据实际应用场景选择开启不同的告警。每种类型的告警特点如下：

-   基线告警：超过或低于某个基准线即触发告警，例如错误率高于1%触发告警。
-   同环比告警：当前的值相比历史某一时间点的变化率，例如流量相比昨天降低10%触发告警。
-   智能告警：日志中心预设了AIOps巡检策略，在发现QPS、延迟等异常的时候会自动记录异常事件，您可以直接设置发现某个异常时触发告警。

## 配置流程

日志中心中已预设各类告警规则、行动策略、用户组和内容模板等告警所需资源。您可以直接使用预设的告警资源，也可以自定义告警资源，具体配置流程如下。

-   使用预设的告警资源

    如果您希望快速完成告警设置，接收告警通知，只需完成如下配置。完成配置后，日志中心根据对应的告警规则产生告警并使用短信、邮件方式给您创建的用户发送告警通知，如果触发严重告警，则发送电话语音告警通知。

    ![slb-alarm1](https://static-aliyun-doc.oss-accelerate.aliyuncs.com/assets/img/zh-CN/9386121161/p223988.png)

    ​​​​​​

-   自定义告警资源

    如果您希望根据实际场景自定义告警资源，您可以根据如下流程完成配置。完成配置后，日志中心根据对应的告警规则产生告警并根据您配置的告警渠道（语音、短信、邮件、钉钉WebHook、WebHook-自定义和通知中心）给对应的用户或用户组发送告警通知。

    ![slb-6](https://static-aliyun-doc.oss-accelerate.aliyuncs.com/assets/img/zh-CN/3869921161/p230654.png)


本文以**SLB访问错误率监控**为例，介绍告警相关配置。当SLB访问错误率超过2%时，触发一般告警，短信通知运维人员；当SLB访问错误率超过8%时，触发严重告警，电话通知运维人员。

## 步骤1：创建用户和用户组

配置用户和用户组指定接收通知的员工A。请参见如下步骤。

1.  登录[日志服务控制台](https://sls.console.aliyun.com)。

2.  在**日志应用**区域，单击**SLB日志中心**。

3.  在左侧导航栏中，展开目标日志中心实例，单击**告警配置**。

4.  选择**告警管理** \> **用户管理**。

5.  创建用户。

    例如创建用户如下。更多信息，请参见[创建用户](/cn.zh-CN/告警/告警（新版）/用户管理/创建用户和用户组.md)。

    ![user1](https://static-aliyun-doc.oss-accelerate.aliyuncs.com/assets/img/zh-CN/3285031161/p230685.png)

6.  创建用户组。

    例如创建用户组如下，并将user1加入该组。更多信息，请参见[创建用户组](/cn.zh-CN/告警/告警（新版）/用户管理/创建用户和用户组.md)。

    ![group1](https://static-aliyun-doc.oss-accelerate.aliyuncs.com/assets/img/zh-CN/3285031161/p230681.png)


## 步骤2：创建内容模板

配置短信和语音通知的内容。请参见如下步骤。

1.  选择**告警管理** \> **内容模板**。

2.  在**内容模板**页面中，单击**添加**。

3.  在添加内容模板对话框中，配置**ID**、**名称**和**发送内容**，单击**确认**。

    例如短信和语音的发送内容配置如下。发送内容支持使用模板变量。更多信息，请参见[创建内容模板](/cn.zh-CN/告警/告警（新版）/通知管理/创建内容模板.md)。

    ![sms](https://static-aliyun-doc.oss-accelerate.aliyuncs.com/assets/img/zh-CN/5147031161/p230751.png)


## 步骤3：创建行动策略

配置通知员工A的行动策略，包括语音和短信渠道。请参见如下步骤。

1.  选择**告警管理** \> **行动策略**。

2.  在添加行动策略对话框中，配置如下参数，单击**确认**。

    例如，对于一般告警和严重告警，配置行动策略如下。

    ![action](https://static-aliyun-doc.oss-accelerate.aliyuncs.com/assets/img/zh-CN/3285031161/p230706.png)

    |参数|描述|
    |--|--|
    |ID|行动策略的唯一标识。|
    |名称|行动策略的名称。|
    |严重告警|严重告警行动策略。    -   渠道：语音
    -   接收人：员工A。选择您在[步骤1：创建用户和用户组](#section_jsx_lyd_xan)中定义的告警通知人员。
    -   内容模板：公司A内容模板。选择您在[步骤2：创建内容模板](#section_6gx_dqp_fym)中定义的告警通知内容模板。 |
    |一般告警|一般告警行动策略。    -   渠道：短信
    -   接收人：员工A。选择您在[步骤1：创建用户和用户组](#section_jsx_lyd_xan)中定义的告警通知人员。
    -   内容模板：公司A内容模板。选择您在[步骤2：创建内容模板](#section_6gx_dqp_fym)中定义的告警通知内容模板。 |


## 步骤4：自定义告警参数并开启实例

SLB日志中心预设的**SLB访问错误率监控**参数不满足告警通知条件，将一般告警阈值修改为2%，严重告警阈值修改为8%。请参见如下步骤。

1.  在**告警规则**页签中，单击**SLB访问错误率监控**对应的**添加**。

2.  在参数设置对话框中，按照对应的提示设置参数值，单击**设置并开启**。

    不同告警规则对应的配置参数不同，请根据界面提示填写配置信息即可。例如，配置如下。

    ![parameter](https://static-aliyun-doc.oss-accelerate.aliyuncs.com/assets/img/zh-CN/2730751161/p232045.png)

    -   SLB白名单：SLB实例白名单。该白名单中SLB实例才会触发告警。您可以通过SLB控制台获取实例ID。支持正则表达式，默认为`.*`，表示监控您阿里云账号下的所有SLB实例。支持配置多个SLB实例，多个实例之间使用竖线分隔，例如`lb-1cd34d1238976|lb-1cd34d1238978`。
    -   SLB黑名单：SLB实例黑名单。该黑名单中SLB实例不会触发告警。您可以通过SLB控制台获取实例ID。支持正则表达式，默认为空。支持配置多个SLB实例，多个实例之间使用竖线分隔，例如`lb-1cd34d1238976|lb-1cd34d1238978`。
    -   告警阈值（一般）：触发一般告警的阈值。
    -   告警阈值（严重）：触发严重告警的阈值。

## 步骤5：关联行动策略

在**SLB访问错误率监控**中关联已创建的公司A行动策略，请参见如下步骤。

1.  在**告警规则**页签中，选中**SLB访问错误率监控**，单击**配置行动策略**。

2.  在参数设置对话框中，从**配置行动策略**列表中，选择**公司A行动策略**，单击**保存**。

    ![action1](https://static-aliyun-doc.oss-accelerate.aliyuncs.com/assets/img/zh-CN/5069031161/p230837.png)


## 相关操作

在**告警规则**页面，您还可以进行如下操作。

|操作|说明|
|--|--|
|关闭告警实例|关闭告警实例，告警规则不会再触发告警，**状态**变更为**未开启**。该操作不会删除参数中定义的配置数据。需要再次开启时，无需重新配置规则参数，可以直接开启。|
|临时关闭告警实例|临时关闭告警实例后，在设置时长内不再触发告警。|
|恢复告警实例|处于临时关闭状态的监控实例，可随时恢复告警。|
|删除告警实例|删除告警实例，**状态**变更为**未创建**。该操作会删除参数中定义的例如SLB白名单、阈值等配置数据。需要再次开启时，需要重新配置参数，才能开启。|

