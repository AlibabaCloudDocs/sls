# 开启SQL日志审计 {#task_dzy_twd_qfb .task}

SQL日志审计功能默认关闭，您可以在DRDS控制台上手动开启。默认情况下，只对开启SQL日志审计功能之后产生的日志数据进行审计分析，您也可以导入部分历史数据。

-   开通阿里云日志服务。
-   已购买DRDS专享实例，并创建了数据库。
-   默认情况下，只有主账号可以开启并操作SQL日志审计功能。子账号开启和操作SQL日志审计功能前，需要先授予日志服务相关权限。详细步骤请参考[子账号授权](cn.zh-CN/用户指南/云产品采集/DRDS SQL审计日志/为子账号授予DRDS SQL审计权限.md)。

SQL审计功能默认为关闭状态。您可以参考本文档开启该功能。开启后会产生额外费用，详细收费标准请参见[按量付费](../../../../cn.zh-CN/产品定价/按量付费.md)。如果您需要关闭该功能，请在DRDS控制台关闭。关闭后不再写入数据，可以查看历史数据，这部分历史数据会产生存储和索引费用。您可以在日志服务控制台删除Logstore以删除历史数据，删除后日志服务不再对该部分数据计费。

当前支持的区域：华东1、华东2、华北1、华北2、华南1。其它地区陆续开放中。

1.  [登录DRDS控制台](https://drds.console.aliyun.com/prectrl/home/index#/overview)，并选择地域。
2.  在实例列表页面单击实例名称。
3.  在左侧导航栏中单击**SQL审计与分析**。
4.  展开下拉框，选择需要开启 SQL 审计与分析的数据库。
5.  请根据页面提示进行授权。授权后，DRDS有权限将日志数据写入日志服务。
6.  在日志状态栏或下拉框中状态栏打开功能开关。 

    ![](http://static-aliyun-doc.oss-cn-hangzhou.aliyuncs.com/assets/img/40471/155840459621186_zh-CN.png)

7.  确认是否导入历史数据。 

    默认情况下，只对开启SQL日志审计功能之后产生的日志数据进行审计分析。

    如果您发现DRDS数据库的数据被修改，但是并未开启SQL审计功能，可以在开启功能时导入历史数据，将过去发生的日志加入审计分析范围，追溯数据篡改者。 DRDS 会根据您 DRDS 实例节点上的日志存储情况，动态检测支持导入的历史数据范围，目前最多支持导入七天内的数据。

    -   如果需要导入历史数据，请打开功能开关，并指定**回溯开始时间**和**回溯结束时间**，并单击**启用**。

        导入历史数据功能基于DRDS节点保存的日志时间动态检测，最大支持导入七天的历史数据。 导入过程涉及文件操作，需要一定的时间，请耐心等待。您可以在控制台右上角的任务列表中查看日志回溯的进度。

    -   如果不需要导入历史数据，请直接单击**启用**。
    ![](http://static-aliyun-doc.oss-cn-hangzhou.aliyuncs.com/assets/img/40471/155840459621243_zh-CN.png)


SQL审计功能已成功开启，相同Region下的DRDS数据库的审计日志会写入同一个日志服务的Logstore中。同时，日志服务为您创建以下默认配置。

**说明：** 请勿随意删除或修改日志服务为您默认创建的Project、Logstore、索引和仪表盘设置，日志服务会不定期更新与升级SQL日志审计功能，专属日志库的索引与默认报表也会自动更新。

|默认配置项|配置内容|
|:----|:---|
|Project|默认为您创建Project`drds-audit-区域名-阿里云账户ID`，例如`drds-audit-cn-qingdao-12345678`。|
|Logstore|默认为您创建Logstore`drds-audit-log`。|
|地域|相同Region下的DRDS数据库的审计日志会写入同一个日志服务的Logstore中。 例如，华东一（杭州）地域中所有可用区的DRDS数据库审计日志都会写入日志服务的Logstore`drds-log-cn-hangzhou-阿里云账户ID`中。

 |
|Shard|默认为您创建5个Shard，并开启[自动分裂Shard](cn.zh-CN/用户指南/准备工作/操作Shard.md) 功能。|
|索引|日志服务自动为您创建索引。您的索引设置会随着功能升级自动更新，请勿手动修改或删除索引。|
|日志存储时间|默认保存30天。30天以上的日志自动删除。 若您需要更长的存储时间，可以自定义修改。详细步骤请参考[高级管理](cn.zh-CN/用户指南/云产品采集/DRDS SQL审计日志/高级管理.md)。

 |
|仪表盘|默认创建三个仪表盘，分别为： -   运营中心
-   性能中心
-   安全中心

 关于仪表盘的更多信息，请参考[日志报表](cn.zh-CN/用户指南/云产品采集/DRDS SQL审计日志/日志报表.md)。 **说明：** 请勿修改默认的仪表盘配置，默认仪表盘会随着功能升级自动更新。您可以参考[创建和删除仪表盘](cn.zh-CN/用户指南/可视化分析/仪表盘/创建和删除仪表盘.md)另外创建新的仪表盘。

 |

