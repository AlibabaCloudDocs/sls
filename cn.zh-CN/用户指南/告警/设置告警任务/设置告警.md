# 设置告警 {#task_fdb_hfm_2fb .task}

在查询页面或仪表盘页面设置告警，日志服务会定时执行检查，并在满足告警条件时发送告警信息。

-   已采集到日志数据。
-   已[开启并配置索引](cn.zh-CN/用户指南/查询与分析/开启并配置索引.md)。

告警基于查询分析图表设置，您可以在查看图表时，将图表保存在仪表盘中，同时另存为告警，也可以在仪表盘页面中对已有的图表设置告警。

-   创建图表并设置告警

    将当前的查询分析语句保存在仪表盘中，并为查询分析语句设置告警。在查询页面设置告警时，您需要指定图表保存到的仪表盘名称和图表名称。

    ![](http://static-aliyun-doc.oss-cn-hangzhou.aliyuncs.com/assets/img/13160/156439138843219_zh-CN.png)

-   在仪表盘中对已有图表设置告警

    为仪表盘中的一个或多个图表设置告警。为多个图表设置告警时，可以设置组合触发条件。

    ![](http://static-aliyun-doc.oss-cn-hangzhou.aliyuncs.com/assets/img/13160/15643913885774_zh-CN.png)


本文档以在仪表盘中对已有图表设置告警为例。

**说明：** 如果仪表盘中的分析图表绑定了告警规则，更新图表的查询分析语句后，需要手动更新告警规则，将告警规则中绑定的查询分析语句修改为更新后的语句。详细说明请参考[更新告警规则](cn.zh-CN/用户指南/告警/修改与查看告警/修改告警规则.md#update_alarm)。

常见告警配置案例请参考[告警配置案例](../cn.zh-CN/常见问题/告警/告警配置案例.md#)。

1.  登录[日志服务控制台](https://sls.console.aliyun.com)，单击Project名称。 
2.  在左侧导航栏中单击仪表盘图标。
3.  单击指定仪表盘名称。
4.  在页面右上角单击**告警** \> **新建**。 

    ![](http://static-aliyun-doc.oss-cn-hangzhou.aliyuncs.com/assets/img/13160/15643913885774_zh-CN.png)

5.  设置告警规则并单击 **下一步**。 告警配置信息如下：

    |规则|说明|
    |:-|:-|
    |**告警名称**|告警的名称。名称长度为1~64个字符。|
    |**关联图表**|设置告警中关联的图表。 单击**添加**，选择**图表名称**并设置**查询区间**。**查询区间**为服务端每次执行查询时，读取的数据时间范围，支持相对时间与绝对时间。例如，执行时间点为14:30:06，设置**查询区间**为15分钟（相对），则查询区间为 14:15:06- 14:30:06；设置**查询区间**为15分钟（绝对），则查询区间为：14:15:00- 14:30:00。

 需要添加多个图表时，只需多次添加并设置即可。图表名称前的编号为该图表在告警中的编号，您可以在触发条件中通过编号指定关联的图表。

 |
    |**频率**|服务端每次执行告警检查的时间。 **说明：** 目前服务端每次告警规则检查只会采样处理时间区间开始的前100条数据。

 |
    |**触发条件**|判断告警是否触发的条件表达式，满足该条件时会根据**执行间隔**和**通知间隔**发送告警通知。 例如，您可以设置为`pv%100 > 0 && uv > 0`。

 **说明：** 触发条件中，通过`$编号`区分不同的关联图表，例如`$0`表示编号为0的图表。

[如何查看图表编号？](cn.zh-CN/用户指南/告警/参考信息/告警条件表达式语法.md#searchNO)

 |
    |**高级选项**|
    |**触发通知阈值**|累计触发次数达到该阈值时根据**通知间隔**发送告警。不满足触发条件时不计入统计。 默认**触发通知阈值**为1，即满足一次**触发条件**即可检查**通知间隔**。

 通过配置触发通知阈值可以实现多次触发、一次通知。例如，配置触发通知阈值为100，则累计触发次数达到100次时检查**通知间隔**。如果同时满足**触发通知阈值**和**通知间隔**，则发送通知。发送通知之后，累计次数会清零。如果因网络异常等原因执行检查失败，不计入累计次数。|
    |**通知间隔**| 两次告警通知之间的时间间隔。

 如果某次执行满足了触发条件，而且累计的触发次数已经达到**触发通知阈值**，且距离上次发送通知已经达到了通知间隔，则发送通知。如设置通知间隔为5分钟，则5分钟内至多收到一次通知。默认无间隔。

 **说明：** 通过配置触发通知阈值和通知间隔可以实现告警抑制的功能，防止收到过多的告警信息。

 |

    ![告警通知方式](http://static-aliyun-doc.oss-cn-hangzhou.aliyuncs.com/assets/img/13160/15643913895775_zh-CN.png)

6.  设置通知方式。 通知方式可以设置一种或多种，包括**短信**、**邮件**、**钉钉**、**WebHook**和**通知中心**。

    通知方式的详细说明及示例请参考[通知方式](cn.zh-CN/用户指南/告警/设置告警任务/通知方式.md)。

    |通知方式|说明|
    |:---|:-|
    |**短信**| 短信形式发送告警通知，需要指定**手机号码**和**发送内容**。

 多个手机号码之间通过逗号（，）分隔。**发送内容**为短信通知的内容，支持使用模板变量，长度为1~100个字符。

 |
    |**邮件**| 邮件形式发送告警通知，需要指定邮箱地址为**收件人**，并指定**发送内容**。

 多个邮箱地址之间通过逗号（，）分隔。**发送内容**为邮件通知的内容，支持使用模板变量，长度为1~500个字符。

 |
    |**钉钉机器人**| 钉钉机器人消息形式发送告警通知，当触发告警时，告警通知会以钉钉机器人消息的形式发送到钉钉群中。需要指定**请求地址**和**发送内容**。

 **发送内容**为钉钉机器人消息的内容，支持使用模板变量，长度为1~500个字符。

 如何设置钉钉机器人、获取**请求地址**，请查看[通知方式](cn.zh-CN/用户指南/告警/设置告警任务/通知方式.md)。

 **说明：** 每个机器人每分钟最多发送20条。

 |
    |**WebHook自定义**| 当触发告警时，告警通知会以指定形式发送到自定义WebHook地址中。需要指定**请求地址**、**请求方法**和**发送内容**。

 **请求方法**可以设置为GET、PUT、POST、DELETE、和OPTIONS。**发送内容**为通知的内容，支持使用模板变量，长度为1~500个字符。

 |
    |**通知中心**| 通过阿里云通知中心中预设的通知方式向联系人发送告警通知。需要指定**发送内容**。**发送内容**为通知消息的内容，支持使用模板变量，长度为1~500个字符。

 添加**通知中心**告警方式，需要在通知中心中设置联系人及通知方式。

 |

    ![告警通知](http://static-aliyun-doc.oss-cn-hangzhou.aliyuncs.com/assets/img/13160/15643913895776_zh-CN.png)

7.  单击**提交**。

创建完成告警规则后，您可以[查看告警配置](cn.zh-CN/用户指南/告警/修改与查看告警/管理告警配置.md)或[查看告警记录](cn.zh-CN/用户指南/告警/修改与查看告警/查看告警记录.md)。

