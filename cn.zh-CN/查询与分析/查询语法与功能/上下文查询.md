# 上下文查询

本文介绍如何在日志服务控制台查看指定日志在原始文件中的上下文信息。

-   已通过Logtail采集到日志，详情请参见[通过Logtail采集日志](/cn.zh-CN/数据采集/Logtail采集/简介/Logtail简介.md)。

    **说明：** 只有通过Logtail采集到的日志才支持上下文功能。

-   已开启并配置索引，详情请参见[开启并配置索引](/cn.zh-CN/查询与分析/开启并配置索引.md)。

日志上下文查询是指定日志来源（机器 + 文件）和其中一条日志，将该日志在原始文件中的前若干条（上文）或后若干条日志（下文）也查找出来。通过查看指定日志的上下文信息，您可以在业务故障排查中快速查找相关故障信息，方便定位问题。

## 应用场景

例如，O2O外卖网站在服务器上的程序日志里会记录一次订单成交的轨迹：用户登录\>浏览商品\>选择物品\>加入购物车\>下单\>订单支付\>支付扣款\>生成订单。

如果客户下单失败，运维人员需要快速定位问题原因。传统的上下文查询中，需要管理员等相关人员添加机器登录权限，然后运维人员依次登录应用所部署的每一台机器，以订单ID为关键词搜索应用程序日志文件，帮助判断下单失败原因。

在日志服务中，可以按照以下步骤排查。

1.  在服务器上安装日志采集客户端Logtail，并在日志服务控制台上添加机器组、Logtail采集配置，然后Logtail开始上传增量日志。
2.  在日志服务控制台日志查询页面，指定时间段根据订单ID找到订单失败日志。
3.  以查到的日志为基准，向上翻页直到发现与之相关的其它日志信息（例如：信用卡扣款失败）。

![应用场景](https://static-aliyun-doc.oss-cn-hangzhou.aliyuncs.com/assets/img/zh-CN/0140559951/p5524.png)

## 功能优势

-   不侵入应用程序，无需改动日志文件格式。
-   在日志服务控制台上查看任意服务器、文件的指定日志的上下文信息。无需登录服务器查看日志的上下文。
-   结合事件发生的时间线索，在日志服务控制台指定时间段快速定位可疑日志后再进行上下文查询，快速定位问题。
-   不用担心服务器存储空间不足或日志文件轮转（rotate）造成的数据丢失，在日志服务控制台上随时可以查看历史数据。

1.  登录[日志服务控制台](https://sls.console.aliyun.com)。

2.  在Project列表区域，单击目标Project。

3.  在**日志存储** \> **日志库**页签中，单击目标Logstore。

4.  输入查询分析语句，选择时间范围并单击**查询/分析**。

5.  在原始日志页签中，找到目标日志，单击**![上下文查询-001](https://static-aliyun-doc.oss-cn-hangzhou.aliyuncs.com/assets/img/zh-CN/0140559951/p93657.png)** \> **上下文浏览**。

6.  使用鼠标在当前页面上下滚动查看指定日志周边的上下文信息。

    -   在输入框中，输入关键词，可实现关键字标红显示。
    -   单击**更早**，进行向上翻页浏览。
    -   单击**更新**，进行向下翻页浏览。
    -   单击**过滤字段**，可添加过滤字段。添加后，在上下文中只显示对应字段。
    ![上下文浏览](https://static-aliyun-doc.oss-cn-hangzhou.aliyuncs.com/assets/img/zh-CN/0140559951/p5526.png)


