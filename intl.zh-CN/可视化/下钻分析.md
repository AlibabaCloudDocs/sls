# 下钻分析

日志服务统计图表提供向下钻取（drill down）的功能，加深数据分析的维度。本文介绍如何在日志服务控制台上配置下钻分析。

-   已开启并配置索引，详情请参见[配置索引](/intl.zh-CN/查询与分析/配置索引.md)。
-   如果配置下钻事件为打开日志库，则需提前创建目标日志库，详情请参见[创建Logstore](/intl.zh-CN/准备工作/管理Logstore.md)。
-   如果配置下钻事件为打开快速查询，则需提前创建目标快速查询，详情请参见[快速查询](/intl.zh-CN/查询与分析/查询语法与功能/快速查询.md)。

    如果要配置变量，则在跳转到的目标快速查询中需配置查询分析语句的占位符变量，详情请参见[设置占位符变量](/intl.zh-CN/可视化/添加统计图表到仪表盘.md)。

-   如果配置下钻事件为打开仪表盘，则需提前创建目标仪表盘，详情请参见[创建仪表盘](/intl.zh-CN/可视化/创建仪表盘.md)。

    如果要配置变量，则在跳转到的目标仪表盘中需有对应的图表已占位符变量，详情请参见[设置占位符变量](/intl.zh-CN/可视化/添加统计图表到仪表盘.md)。

-   如果配置下钻事件为自定义http链接，则需提前准备好http链接。

钻取是数据分析中不可缺少的功能之一，通过改变数据维度的层次、变换分析的粒度从而获取数据中更详尽的信息。它包括向上钻取（roll up）和向下钻取（drill down）。向下钻取是在分析时加深维度，更深入的查看数据，挖掘更大的数据价值，及时做出更加正确的决策。

## 操作步骤

1.  登录[日志服务控制台](https://sls.console.aliyun.com)。

2.  在Project列表区域，单击目标Project。

3.  在**日志存储** \> **日志库**页签中，单击目标Logstore。

4.  输入查询分析语句并设置时间范围，单击**查询/分析**。

5.  在**统计图表**页签中选择图表类型，并设置属性。

    属性配置详情请参见[分析图表](/intl.zh-CN/可视化/统计图表/图表说明.md)。

6.  在**交互行为**页签中设置下钻事件。

    下钻事件包括不开启、打开日志库、打开快速查询、打开仪表盘和自定义http链接，具体操作如下所示。

    -   **不开启**：表示不开启下钻功能。
    -   **打开日志库**：设置下钻事件为打开日志库，具体配置如下所示。

        |参数|说明|
        |--|--|
        |**打开新窗口**|开启该选项，则在触发下钻事件时将在新窗口打开目标日志库的查询页面。|
        |**请选择日志库**|选择目标日志库。在触发下钻事件后，将跳转到该日志库的查询页面。|
        |**时间范围**|设置目标日志库的查询时间范围。可以设置为：         -   预设：在仪表盘页面单击字段值，跳转到目标日志库的查询页面后，保持日志服务的默认查询时间范围，即15分钟（相对）。
        -   继承图表时间：在仪表盘页面单击字段值，跳转到目标日志库的查询页面后，对应的查询时间范围为触发下钻事件时图表对应的时间。
        -   相对时间：在仪表盘页面单击字段值，跳转到目标日志库的查询页面后，对应的查询时间范围为当前指定的相对时间。
        -   整点时间：在仪表盘页面单击字段值，跳转到目标日志库的查询页面后，对应的查询时间范围为当前指定的整点时间。 |
        |**是否继承过滤**|打开**是否继承过滤**开关，将当前仪表盘已有的过滤条件同步到跳转后的目标日志库的查询页面中，并以`AND`方式添加到查询分析语句之前。|
        |**过滤**|在**过滤**页签中输入过滤语句，可将该过滤语句同步到跳转后的目标日志库的查询页面中，并以`AND`方式添加到查询分析语句之前。 支持在过滤语句中插入**可选参数域**，将对应字段的值作为过滤条件。 |

    -   **打开快速查询**：设置下钻事件为打开快速查询，具体配置如下所示。

        |说明|说明|
        |:-|:-|
        |**打开新窗口**|开启该选项，则在触发下钻事件时将在新窗口打开目标快速查询页面。|
        |**请选择快速查询**|选择目标快速查询。在触发下钻事件后，将跳转到该快速查询页面。|
        |**时间范围**|设置目标快速查询的时间范围。可以设置为：         -   预设：在仪表盘页面中单击字段值，跳转到目标快速查询页面后，保持日志服务的默认查询时间范围，即15分钟（相对）。
        -   继承图表时间：在仪表盘页面单击字段值，跳转到目标快速查询页面后，对应的查询时间范围为触发下钻事件时图表对应的时间。
        -   相对时间：在仪表盘页面中单击字段值，跳转到目标快速查询页面后，对应的查询时间范围为当前指定的相对时间。
        -   整点时间：在仪表盘页面中单击字段值，跳转到目标快速查询页面后，对应的查询时间范围为当前指定的整点时间。 |
        |**是否继承过滤**|打开**是否继承过滤**开关，将当前仪表盘已有的过滤条件同步到跳转后的目标快速查询页面中，并以`AND`方式添加到查询分析语句之前。|
        |**是否继承变量**|打开**是否继承变量**开关后，如果当前仪表盘中已有的变量和目标快速查询的查询分析语句中的变量相同，会将查询分析语句中的变量替换为当前仪表盘中的变量值。 **说明：** 如果要继承变量，则需要提前在跳转到的目标快速查询中配置查询分析语句的占位符变量。 |
        |**过滤**|在**过滤**页签中输入过滤语句，可将该过滤语句同步到跳转后的目标快速查询页面中，并以`AND`方式添加到查询分析语句之前。 支持在过滤语句中插入**可选参数域**，将对应字段的值作为过滤条件。 |
        |**变量**|日志服务支持通过变量灵活修改目标快速查询的查询分析语句，当此处添加的变量和目标快速查询的查询分析语句中的变量相同时，会将查询分析语句中的变量替换为触发下钻事件的字段值。您可以在**变量**页签中配置变量。 **说明：**

        -   如果选择添加变量，则需要提前在跳转到的目标快速查询中配置查询分析语句的占位符变量。
        -   最多可添加5个动态变量和5个静态变量。
        -   动态变量
            -   **动态变量名**：配置变量名。
            -   **动态变量值所在列**：以指定列对应的值动态替换目标快速查询的查询分析语句中的变量。
        -   静态变量
            -   **静态变量名**：配置变量名。
            -   **静态值**：以固定的字段值替换目标快速查询的查询分析语句中的变量。 |

    -   **打开仪表盘**：设置下钻事件为打开仪表盘，具体配置如下所示。

        |参数|说明|
        |:-|:-|
        |**打开新窗口**|开启该选项，则在触发下钻事件时将在新窗口打开目标仪表盘页面。|
        |**请选择仪表盘**|选择目标仪表盘。在触发下钻事件后，将跳转到该仪表盘页面。|
        |**时间范围**|设置目标仪表盘的时间范围。可以设置为：         -   预设：在仪表盘页面单击字段值，跳转到目标仪表盘页面后，保持日志服务的默认查询时间范围，即15分钟（相对）。
        -   继承图表时间：在仪表盘页面单击字段值，跳转到目标仪表盘页面后，对应的查询时间范围为触发下钻事件时图表对应的时间。
        -   相对时间：在仪表盘页面单击字段值，跳转到目标仪表盘页面后，对应的查询时间范围为当前指定的相对时间。
        -   整点时间：在仪表盘页面单击字段值，跳转到目标仪表盘页面后，对应的查询时间范围为当前指定的整点时间。 |
        |**是否继承过滤**|打开**是否继承过滤**开关，将当前仪表盘已有的过滤条件同步到跳转后的目标仪表盘中。|
        |**是否继承变量**|开启**是否继承变量**开关，将当前仪表盘中已有的变量同步到跳转后的目标仪表盘中。|
        |**过滤**|在**过滤**页签中输入过滤语句，可将该过滤语句同步到跳转后的目标仪表盘页面中。 支持在过滤语句中插入**可选参数域**，将对应字段的值作为过滤条件。 |
        |**变量**|日志服务支持将此处的变量同步到跳转后的目标仪表盘中。您可以在**变量**页签中配置变量。 **说明：**

        -   如果选择添加变量，则需要提前在跳转到的目标仪表盘的图表中配置查询分析语句的占位符变量。
        -   最多可添加5个动态变量和5个静态变量。
        -   动态变量
            -   **动态变量名**：配置变量名。
            -   **动态变量值所在列**：以指定列对应的值动态同步到目标仪表盘中。
        -   静态变量
            -   **静态变量名**：配置变量名。
            -   **静态值**：以固定的字段值同步到目标仪表盘中。 |

    -   **自定义http链接**：设置下钻事件为打开自定义http链接。

        http链接中的路径部分表示访问的目的端文件的层级路径，您可以在定义http链接的路径部分添加可选参数域，单击仪表盘中的图表内容时，会用字段值替换http链接中的参数，跳转到重新定位的http链接中。

        |配置|说明|
        |:-|:-|
        |**请输入链接地址**|需要跳转到的目标地址。|
        |**使用系统变量**|打开**使用系统变量**开关后，可选择日志服务的系统变量插入到 HTTP链接中，包括$\{sls\_project\}、$\{sls\_dashboard\_title\}、$\{sls\_chart\_name\}、$\{sls\_chart\_title\}、$\{sls\_region\}、$\{sls\_start\_time\}、$\{sls\_end\_time\}、$\{sls\_realUid\}和$\{sls\_aliUid\}。|
        |**是否转码**|打开**是否转码**开关后，会将链接中的内容进行encode转码。|
        |**可选参数域**|日志服务支持将链接中的某一部分替换为触发下钻事件的字段值。|

7.  单击**添加到仪表盘**。

8.  设置仪表盘名称和图表名称，单击**确定**。


## 示例

将Nginx访问日志采集到名为accesslog的日志库中并创建两个仪表盘（RequestMethod和destination\_drilldown）实现下钻分析。在名为RequestMethod的仪表盘中，添加请求方法分类表格，并设置下钻事件为打开destination\_drilldown仪表盘。在名为destination\_drilldown的仪表盘中，添加PV随时间分布的折线图。设置完成后，您在RequestMethod仪表盘中单击各个请求方法即可跳转到destination\_drilldown仪表盘查看对应的PV趋势。

1.  创建仪表盘destination\_drilldown。

    在为请求方法的分类表格配置下钻分析前，需先创建目标仪表盘并添加PV趋势图表，重要配置如下所示，具体步骤请参见[添加统计图表到仪表盘](/intl.zh-CN/可视化/添加统计图表到仪表盘.md)。

    -   查询分析语句

        该查询分析语句表示根据请求类型查询日志，并查看PV随时间的变化。

        ```
        request_method: * | SELECT date_format(date_trunc('minute', __time__), '%H:%i:%s') AS time, COUNT(1) AS PV GROUP BY time ORDER BY time
        ```

    -   设置占位符变量

        将查询分析语句中的星号（\*）设置为占位符变量，并命名为method。

        ![占位符](https://static-aliyun-doc.oss-accelerate.aliyuncs.com/assets/img/zh-CN/5616317951/p10732.png)

2.  为请求方法的分类表格配置下钻分析，并将其添加到仪表盘RequestMethod。

    重要配置如下所示，具体步骤请本文的[操作步骤](#section_cnd_wl3_y2b)。

    -   查询分析语句

        该查询分析语句表示分析Nginx访问日志中各种请求方法（request\_method）对应的日志条数。

        ```
        *|SELECT request_method, COUNT(1) AS c GROUP BY request_method ORDER BY c DESC LIMIT 10
        ```

    -   选择图表类型

        此处以表格为例。

    -   设置下钻分析

        -   选择request\_method列，设置下钻分析。
        -   设置**请选择仪表盘**为**destination\_drilldown**。
        -   设置**动态变量名**为**method**
        ![事件行为](https://static-aliyun-doc.oss-accelerate.aliyuncs.com/assets/img/zh-CN/3996076951/p10708.png)

3.  查看下钻事件配置结果。

    在RequestMethod仪表盘中单击**GET**，跳转到destination\_drilldown仪表盘。原查询分析语句中的星号（\*）已替换为您所单击的字段值**GET**，表示查看GET请求对应的PV随时间的变化。

    ![请求方法](https://static-aliyun-doc.oss-accelerate.aliyuncs.com/assets/img/zh-CN/5616317951/p10714.png)

    ![跳转后仪表盘](https://static-aliyun-doc.oss-accelerate.aliyuncs.com/assets/img/zh-CN/5616317951/p10739.png)


