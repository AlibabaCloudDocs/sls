# 配置索引

索引是一种存储结构，用于对日志数据中的一列或多列进行排序。您只有配置索引后，才能进行查询和分析操作。不同的索引配置，会产生不同的查询和分析结果，请根据您的需求，合理配置索引。

已采集日志。更多信息，请参见[数据采集](/intl.zh-CN/数据采集/采集方式.md)。

## 索引类型

日志服务的索引类型如下：

|索引类型|说明|
|:---|:-|
|全文索引|日志服务根据您设置的分词符将整条日志拆分成多个词并构建索引。在查询时，字段名称（KEY）和字段值（Value）都是普通文本。例如查询语句`error`，表示查询包含`error`关键字的日志。|
|字段索引|配置字段索引后，您可以指定字段名称和字段值（Key:Value）进行查询，缩小查询范围。例如查询语句`level:error`，表示查询`level`字段值包含`error`的日志。如果您要使用分析功能，必须配置字段索引且开启对应字段的统计功能。开启统计功能不会产生额外的索引流量和索引存储空间。 |

**说明：**

-   开启索引后会产生索引流量和索引存储空间，费用说明请参见[计量项和计费项](/intl.zh-CN/产品计费/计量项和计费项.md)。
-   配置索引后，只对新写入的日志数据生效。如果您要查询和分析历史数据，请使用重建索引功能。具体操作，请参见[重建索引](/intl.zh-CN/查询与分析/查询语法与功能/重建索引.md)。
-   如果同时配置了全文索引和字段索引，以字段索引的配置为准。
-   日志服务默认已为部分保留字段配置索引。更多信息，请参见[保留字段](/intl.zh-CN/产品简介/使用限制/保留字段.md)。其中`__topic__`和`__source__`的索引分词符为空，查询这两个字段时，查询关键字必须完全匹配。

## 配置全文索引

1.  登录[日志服务控制台](https://sls.console.aliyun.com)。

2.  在Project列表区域，单击目标Project。

3.  在**日志存储** \> **日志库**页签中，单击目标Logstore。

4.  在Logstore的查询和分析页面，选择**查询分析属性** \> **属性**。

    如果您还未开启索引，请单击**开启索引**。

5.  配置索引。

    |参数|说明|
    |:-|:-|
    |**日志聚类**|打开**日志聚类**开关后，在采集文本日志时日志服务会自动聚合相似度高的日志，提取共同的日志模式，帮助您快速掌握日志整体情况。更多信息，请参见[日志聚类](/intl.zh-CN/查询与分析/查询语法与功能/日志聚类.md)。|
    |**全文索引**|打开**全文索引**开关，表示开启全文索引功能。|
    |**大小写敏感**|查询时是否区分英文字母的大小写。     -   打开**大小写敏感**开关，则查询时区分大小写。例如某条日志含有`internalError`，那么您只能使用`internalError`才能查询到该日志。
    -   关闭**大小写敏感**开关，则查询时不区分大小写。例如某条日志含有`internalError`，那么您使用关键字`INTERNALERROR`和`internalerror`都能查到该日志。 |
    |**包含中文**|查询时是否区分中英文。     -   打开**包含中文**开关后，如果日志中包含中文，则按照中文语法拆分中文内容，按照分词符配置拆分英文内容。

**说明：** 中文分词对写入速度会有一定影响，请根据需求谨慎设置。

    -   关闭**包含中文**开关后，按照分词符配置拆分所有内容。 |
    |**分词符**|根据指定分词符，将日志内容拆分成多个词。分词符包括`, '";=()[]{}?@&<>/:\n\t\r`，其中`\n`表示换行符，`\t`表示制表符，`\r`表示回车符。例如日志内容为`/url/pic/abc.gif`。

    -   如果不设置任何分词符，整条日志被作为一个词`/url/pic/abc.gif`，您只能通过完整字符串`/url/pic/abc.gif`或模糊查询`/url/pic/*`查找该日志。
    -   如果设置分词符为正斜线（/），则原始日志被拆分为`url`、`pic`和`abc.gif`三个词，您通过任意一个词或词的模糊查询都可以找到该日志，例如`url`、`abc.gif`、`pi*`、`/url/pic/abc.gif`。
    -   如果设置分词符为正斜线（/）和半角句号（.），则原始日志被拆分为`url`、`pic`、`abc`和`gif`四个词。 |

6.  单击**确定**，完成配置。

    配置索引后，在1分钟之内生效。


## 配置字段索引

1.  登录[日志服务控制台](https://sls.console.aliyun.com)。

2.  在Project列表区域，单击目标Project。

3.  在**日志存储** \> **日志库**页签中，单击目标Logstore。

4.  在Logstore的查询和分析页面，选择**查询分析属性** \> **属性**。

    如果您还未开启索引，请单击**开启索引**。

5.  在查询分析页面，配置索引。

    |参数|说明|
    |:-|:-|
    |**字段名称**|日志字段名称（KEY），例如client\_ip。 **说明：**

    -   如果配置公网IP地址、Unix时间戳等Tag字段的索引，请将**字段名称**配置为\_\_tag\_\_:KEY形式，例如：\_\_tag\_\_:\_\_receive\_time\_\_。更多信息，请参见[保留字段](/intl.zh-CN/产品简介/使用限制/保留字段.md)。
    -   Tag字段不支持数值类型索引，请将所有Tag字段的索引的**类型**配置为**text**。 |
    |**类型**|日志字段值（Value）的数据类型，可选值为text、long、double和json。更多信息，请参见[数据类型](/intl.zh-CN/查询与分析/数据类型.md)。 **说明：** long类型和double类型不支持设置**大小写敏感**、**包含中文**和**分词符**。 |
    |**别名**|列的别名，例如ip。 别名仅用于分析语句，查询时仍需使用原始字段名称。更多信息，请参见[列的别名](/intl.zh-CN/查询与分析/SQL分析语法与功能/列的别名.md)。 |
    |**大小写敏感**|查询时是否区分英文字母大小写。    -   打开**大小写敏感**开关，则查询时区分大小写。例如某条日志含有`internalError`，那么您只能使用`internalError`才能查询到该日志。
    -   关闭**大小写敏感**开关，则查询时不区分大小写。例如某条日志含有`internalError`，那么您使用关键字`INTERNALERROR`和`internalerror`都能查到该日志。 |
    |**分词符**|根据指定分词符，将日志内容拆分成多个词。分词符包括`, '";=()[]{}?@&<>/:\n\t\r`，其中`\n`表示换行符，`\t`表示制表符，`\r`表示回车符。例如日志内容为`/url/pic/abc.gif`。

    -   如果不设置任何分词符，整条日志被作为一个词`/url/pic/abc.gif`，您只能通过完整字符串`/url/pic/abc.gif`或模糊查询`/url/pic/*`查找该日志。
    -   如果设置分词符为正斜线（/），则原始日志被拆分为`url`、`pic`和`abc.gif`三个词，您通过任意一个词或词的模糊查询都可以找到该日志，例如`url`、`abc.gif`、`pi*`、`/url/pic/abc.gif`。
    -   如果设置分词符为正斜线（/）和半角句号（.），则原始日志被拆分为`url`、`pic`、`abc`和`gif`四个词。 |
    |**包含中文**|查询时是否区分中英文。     -   打开**包含中文**开关后，如果日志中包含中文，则按照中文语法拆分中文内容，按照分词符配置拆分英文内容。

**说明：** 中文分词对写入速度会有一定影响，请根据需求谨慎设置。

    -   关闭**包含中文**开关后，按照分词符配置拆分所有内容。 |
    |**开启统计**|打开**开启统计**功能后，您才能使用分析功能。|

6.  单击**确定**，完成配置。

    配置索引后，在1分钟之内生效。


