# 设置告警

日志服务支持在查询和分析页面或仪表盘页面设置告警，并在满足告警条件时发送告警通知。

-   已采集到日志数据。
-   已配置索引。具体操作，请参见[配置索引](/intl.zh-CN/查询与分析/配置索引.md)。

日志服务支持基于统计图表设置告警。您可以在查看图表时，将图表保存在仪表盘中，同时另存为告警，也可以在仪表盘页面中对已有的图表设置告警。

**说明：** 如果仪表盘中的图表绑定了告警规则，更新图表的查询分析语句后，需要手动更新告警规则，将告警规则中绑定的查询和分析语句修改为更新后的语句。更多信息，请参见[修改告警配置](/intl.zh-CN/告警/告警（旧版）/管理告警配置.md)。

-   创建图表并设置告警

    在查询页面设置告警时，您需要指定图表保存到的仪表盘名称和图表名称。

    ![图表告警](https://static-aliyun-doc.oss-accelerate.aliyuncs.com/assets/img/zh-CN/6198812261/p43219.png)

-   在仪表盘页面对已有图表设置告警

    为仪表盘中的一个或多个图表设置告警。为多个图表设置告警时，可以设置组合触发条件。

    ![仪表盘告警](https://static-aliyun-doc.oss-accelerate.aliyuncs.com/assets/img/zh-CN/6198812261/p5774.png)


## 操作步骤

1.  登录[日志服务控制台](https://sls.console.aliyun.com)。

2.  单击目标Project。

3.  在左侧导航栏中，选择**资源** \> **仪表盘**。

4.  在仪表盘列表中，单击目标仪表盘。

5.  在仪表盘页面，单击**告警** \> **创建旧版告警**。

6.  在告警配置向导中，设置如下参数，然后单击**下一步**。

    |参数|说明|
    |:-|:-|
    |**告警名称**|告警名称，长度为1~64个字符。|
    |**关联图表**|设置告警所关联的图表。日志服务支持添加1~3个图表，即支持同时对1~3个查询和分析结果设置告警。 图表名称前的编号为该图表在告警中的编号，您可以在**触发条件**中通过编号指定关联的图表。

**查询区间**用于指定查询和分析数据的时间范围。例如，当前时间为14:30:06，设置**查询区间**为1小时（相对），则表示实际查询和分析的是13:30:06-14:30:06期间的数据。

单击查询和分析语句后面的![编辑](https://static-aliyun-doc.oss-accelerate.aliyuncs.com/assets/img/zh-CN/4524008951/p109887.png)图标，可修改查询和分析语句。如何书写查询和分析语句，请参见[分析简介](/intl.zh-CN/查询与分析/分析简介.md)。 |
    |**频率**|日志服务根据您配置的频率对查询和分析结果进行检查。    -   **每小时**：每小时检查一次查询和分析结果。
    -   **每天**：在每天的某个固定时间点检查一次查询和分析结果。
    -   **每周**：在周几的某个固定时间点检查一次查询和分析结果。
    -   **固定间隔**：按照固定间隔检查查询和分析结果。
    -   **Cron**：通过Cron表达式指定时间间隔，按照指定的时间间隔检查查询和分析结果。

Cron表达式的最小精度为分钟，24小时制，例如0 0/1 \* \* \*从00:00开始，每隔1小时检查一次。

**说明：** 日志服务只检查查询和分析结果中的前100条日志。 |
    |**触发条件**|触发告警的条件表达式，即满足该条件时产生告警。更多信息，请参见[告警条件表达式语法](/intl.zh-CN/告警/告警（旧版）/参考信息/告警条件表达式语法.md)。多个条件之间使用2个and符号（&&）连接， 例如`pv%100 > 0 && uv > 0`。

通过$编号区分不同的关联图表。例如`$0.pv>1000&&$1.pv>1000`，其中$0表示编号为0的图表，$1表示编号为1的图表。更多信息，请参见[如何查看图表编号](#section_kqs_ecc_0tr)。 |
    |**触发通知阈值**|累计触发次数达到该值时，根据通知间隔发送告警。不满足触发条件时不计入统计。 默认值为1，即满足一次触发条件就检查通知间隔。

通过配置通知阈值可以实现多次触发，一次通知。例如**触发通知阈值**为100，则累计触发次数达到100次时检查通知间隔，如果同时满足**触发通知阈值**和**通知间隔**，则发送通知。发送通知之后，累计次数会清零。如果因网络异常等原因执行检查失败，不计入累计次数。 |
    |**通知间隔**|两次告警通知之间的时间间隔。 如果某次查询符合触发条件，累计的触发次数达到**触发通知阈值**，且距离上次发送通知的时间已满足**通知间隔**，则发送通知。例如通知间隔为5分钟，则5分钟内最多收到一次通知。

**说明：** 通过配置触发通知阈值和通知间隔可以实现告警抑制的功能，防止收到过多的告警信息。 |

7.  在通知向导中，设置通知方式，然后单击**提交**。

    通知方式包括邮件、WebHook-钉钉机器人、WebHook-自定义和通知中心。您可以执行多次添加，添加多种通知方式，你也可以单击**导入已有通知方式**，通知方式介绍与操作步骤请参见[通知方式](/intl.zh-CN/告警/告警（旧版）/通知方式.md)。


## 常见问题

如何查看图表编号？

在**关联图表**中显示各个图表及查询语句的编号。其中第一个图表及查询语句编号为0，第二个图表及查询语句编号为1，第三个图表及查询语句编号为2。

![查看图表编号](https://static-aliyun-doc.oss-accelerate.aliyuncs.com/assets/img/zh-CN/4524008951/p39405.png)

创建告警规则后，您可以查看告警记录。具体操作，请参见[查看告警记录](/intl.zh-CN/告警/告警（旧版）/查看告警记录.md)。

