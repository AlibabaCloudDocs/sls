# 快速设置日志告警

日志服务支持您为查询和分析结果设置告警监控规则，并在满足条件时触发告警。本文以网站访问日志为例，说明如何快速为日志设置告警。

已在数据实验室中生成模拟的网站访问日志。具体操作，请参见[使用数据实验室]()。

日志服务数据实验室提供模拟的网站访问日志及相关仪表盘（网站审计中心、网站访问中心等），便于您熟悉查询、分析、告警等操作。本案例以监控**网站审计中心**仪表盘中的统计图表**请求成功率**和**响应时间趋势**为例，当请求成功率低于90%、响应时间高于60s时，触发告警，并通过短信方式通知给SLS运维组。

## 步骤一：创建用户和用户组

用户和用户组用于指定告警通知对象。例如创建用户（Alice和Kumar）、用户组（SLS运维组），并将Alice和Kumar加入到SLS运维组中。

1.  登录[日志服务控制台](https://sls.console.aliyun.com)。

2.  进入用户管理页面。

    1.  在Project列表区域，单击目标Project（datalab-12\*\*\*\*408-cn-chengdu）。

    2.  在左侧导航栏中，单击**告警**。

    3.  单击**打开告警中心**，选择**告警管理** \> **用户管理**。

        ![用户管理](https://static-aliyun-doc.oss-accelerate.aliyuncs.com/assets/img/zh-CN/3148059161/p254178.png)

3.  创建用户。

    1.  单击**批量添加**。

    2.  在待添加页签中，输入用户信息，单击**确认**。

        重要参数说明和配置示例如下所示：

        ```
        #标识符，姓名，是否启用，国家号-手机号，可收短信，可接电话
        1001,Kumar,true,86-1381111*****,true,true
        1002,Alice,true,86-1381111*****,true,true
        ```

        |参数|描述|示例|
        |--|--|--|
        |**标识符**|用户唯一标识，不可重复。满足如下规则：        -   以字母开头
        -   长度：5位~60位
        -   包含数字、字母、下划线（\_）、短划线（-）和半角句号（.）的字符串。
|1001、1002|
        |**姓名**|用户姓名。姓名长度为1位~20位字符且不能使用如下字符：

"\\$\|~?&<\>\{\}\`'

|Kumar、Alice|
        |**是否启用**|是否允许日志服务给该用户发送告警通知。        -   true：允许发送。
        -   false：不发送。
|true|
        |**国家号-手机号**|用户手机号码，其中国家号为数字形式，长度为1~4个字符。|86-1381111\*\*\*\*\*、86-1381112\*\*\*\*\*|
        |**可收短信**|是否允许日志服务给该手机号码发送短信通知。        -   true：允许。
        -   false：不允许。
|true|
        |**可接电话**|是否允许日志服务给该手机号码发送语音通知。        -   true：允许。
        -   false：不允许。
|true|

4.  创建用户组。

    1.  在**告警管理**下拉框中，单击**用户组管理**。

    2.  单击**创建**。

    3.  在添加用户组对话框中，配置如下参数，单击**确认**。

        重要参数说明和配置示例如下所示：

        |参数|描述|示例|
        |--|--|--|
        |**标识符**|用户组唯一标识，不可重复。满足如下规则：        -   以字母开头。
        -   长度：5位~60位。
        -   包含数字、字母、下划线（\_）、短划线（-）和半角句号（.）的字符串。
|group-01|
        |**组名**|用户组名称。长度不超过20且不包括如下特殊字符的字符串：

\\$\|~?&<\>\{\}\`'"

|SLS运维组|
        |**待添加成员**|您已创建的用户。|Kumar、Alice|
        |**已添加成员**|已添加到用户组的用户。|Kumar、Alice|
        |**启用**|是否允许日志服务给该用户组发送告警通知。        -   打开**启用**开关：允许。
        -   关闭**启用**开关：不允许。
|打开**启用**开关|


## 步骤二：创建日志告警监控规则

告警监控规则用于监控日志查询和分析结果。例如监控统计图表**请求成功率**和**响应时间趋势**，当请求成功率低于90%，响应时间高于60s时，触发告警。

1.  在**日志存储** \> **日志库**页签中，单击目标Logstore。

2.  在页面右上角，选择**另存为告警** \> **新版告警（公测中）**。

3.  在告警规则面板中，配置如下参数，并单击**确定**。

    必要参数说明和配置示例如下所示：

    ![创建监控告警规则](https://static-aliyun-doc.oss-accelerate.aliyuncs.com/assets/img/zh-CN/2088620261/p253647.png)

    |参数|描述|示例|
    |--|--|--|
    |**规则名称**|配置告警监控规则名称。|网站日志告警监控规则|
    |**检查频率**|根据您配置的频率对查询和分析结果进行检查。    -   **每小时**：每小时检查一次查询和分析结果。
    -   **每天**：在每天的某个固定时间点检查一次查询和分析结果。
    -   **每周**：在周几的某个固定时间点检查一次查询和分析结果。
    -   **固定间隔**：按照固定间隔检查查询和分析结果。
    -   **Cron**：通过Cron表达式指定时间间隔，按照该指定的时间间隔检查查询和分析结果。

Cron表达式的最小精度为分钟，24小时制，例如0 0/1 \* \* \*表示从00:00开始，每隔1小时检查一次。

|每天，00:00|
    |**查询统计**|配置查询和分析语句。配置多个查询统计时，您可以指定**集合操作**关联多个查询结果。更多信息，请参见[多集合操作机制](/intl.zh-CN/告警（新版）/告警监控/协同监控/多集合操作机制.md)。

|    -   0：选择**网站审计中心**仪表盘中的**请求成功率**图表。
    -   1：选择**网站审计中心**仪表盘中的**响应时间趋势**图表。
    -   **集合操作**配置为**笛卡尔积**。 |
    |**分组评估**|日志服务支持对查询和分析结果进行分组。    -   **标签自定义**：日志服务根据您配置的字段对查询和分析结果进行分组。分组后，每个组单独评估触发条件。在每个检查周期内，查询和分析结果满足触发条件时，各个分组各自产生一条告警。

您可配置多个字段，多个字段之间使用逗号（,）分隔。

    -   **不分组**：在每个检查周期内，满足触发条件时，只产生一条告警。
    -   **标签自动**：监控时序数据的查询和分析结果时 ，日志服务支持自动分组。
|不分组|
    |**触发条件**|配置触发告警的条件。    -   **有数据**：当查询和分析结果中存在数据时，触发告警。
    -   **有特定条数据**：当查询和分析结果中存在N条数据时，触发告警。
    -   **有数据匹配**：当查询和分析结果中存在数据满足告警表达式时，触发告警。
    -   **有特定条数据匹配**：当查询和分析结果中存在N条数据满足告警表达式时，触发告警。
更多信息，请参见[告警条件表达式语法](/intl.zh-CN/可视化与告警/告警/参考信息/告警条件表达式语法.md)。

|有数据匹配，$0.success\_ratio <90&&$1.平均响应时间\\\(s\\\) \>60**说明：** 当字段中存在括号\(\)时，需使用反斜线（\\）进行转义。 |
    |**告警严重度**|配置告警的严重度。主要用于告警降噪控制和告警通知控制，即您在创建告警策略或行动策略时，可添加关于告警严重度的判断条件。更多信息，请参见[设置告警严重度](/intl.zh-CN/告警（新版）/告警监控/监控规则编排/设置告警严重度.md)。    -   简单配置：直接选择告警严重度，则表示通过该规则产生的告警都为同一严重度。
    -   分条件配置：单击**添加**，分条件设置告警严重度。条件表达式详情请参见[告警条件表达式语法](/intl.zh-CN/可视化与告警/告警/参考信息/告警条件表达式语法.md)。
|中（Medium-6）|
    |**添加标注**|日志服务允许您给产生的告警添加非标识性属性，键值对格式。主要用于告警降噪控制和告警通知控制，即您在创建告警策略或行动策略时，可添加关于标注的判断条件。更多信息，请参见[标签和标注](/intl.zh-CN/告警（新版）/告警监控/监控规则编排/标签和标注.md)。|    -   标题（title）：监控网站请求成功率和平均响应时间
    -   描述（desc）：请求成功率：$\{success\_ratio\}，平均响应时间：$\{平均响应时间\(s\)\} |
    |**自动添加标注**|打开**自动添加标注**开关后，自动在告警中添加\_\_count\_\_、\_\_topic\_\_等信息。更多信息，请参见[自动标注](/intl.zh-CN/告警（新版）/告警监控/监控规则编排/标签和标注.md)。|无|
    |**连续触发阈值**|配置连续触发阈值。当累计的触发次数达到该值时，产生一条告警。不满足触发条件时不计入统计。|1|
    |**告警策略**|告警策略用于合并、静默和抑制已产生的告警。    -   选择**极简模式**和**普通模式**时，您无需配置告警策略。日志服务默认使用SLS内置动态告警策略（sls.builtin.dynamic）进行告警管理。
    -   选择**高级模式**时，您可以选择内置的或自定义的告警策略进行告警管理。如何创建告警策略，请参见[创建告警策略](/intl.zh-CN/告警（新版）/告警管理/创建告警策略.md)。
|极简模式|
    |**行动策略**|行动策略用于控制告警通知渠道和频率等。当**告警策略**选择为**极简模式**时，您只需在此处配置行动组即可。

您配置行动组后，日志服务自动为您创建一个名为`规则名称-行动策略`的行动策略。由该告警监控规则触发的所有告警都通过该行动策略发送通知。如何配置，请参见[通知渠道说明](/intl.zh-CN/告警（新版）/通知管理/通知渠道/通知渠道说明.md)。

**说明：** 您可以在行动策略管理页面，修改该行动策略。具体操作，请参见[创建行动策略](/intl.zh-CN/告警（新版）/通知管理/创建行动策略.md)。如果您在修改行动策略时添加了判断条件，则此处的**告警策略**将自动变更为**普通模式**。

|    -   **渠道**：短信
    -   **接收人**：SLS运维组
    -   **内容模板**：SLS内置内容模板
    -   **发送时段**：任意 |
    |**重复等待**|在重复等待时间内，重复的告警只触发一次行动策略，即只发送一次告警通知。|5分钟|


## 步骤三：查看告警触发记录

创建告警监控规则后，日志服务会根据您创建的规则监控查询和分析结果。当查询和分析结果满足触发条件时，触发告警。您可以在**监控规则中心**仪表盘中查看告警触发的记录。

1.  在告警中心页面，选择**告警管理** \> **监控规则中心**。

2.  在告警监控规则最新评估状态区域，查看已执行的告警监控规则。

    ![查看告警](https://static-aliyun-doc.oss-accelerate.aliyuncs.com/assets/img/zh-CN/5029059161/p253652.png)


