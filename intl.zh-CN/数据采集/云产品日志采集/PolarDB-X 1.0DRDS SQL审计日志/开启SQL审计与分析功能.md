# 开启SQL审计与分析功能

本文介绍如何在云原生分布式数据库控制台上开启SQL审计与分析功能，将DRDS SQL审计日志推送到日志服务。

-   已开通阿里云日志服务。
-   已购买DRDS 实例，详情请参见[步骤一：购买DRDS实例]()。
-   已创建数据库，详情请参见[步骤二：创建DRDS数据库]()。

1.  登录[分布式关系型数据库控制台](https://drdsnew.console.aliyun.com/?spm=5176.12818093.nav-right.1.6cb212d2W6WNSb#/instanceList/cn-hongkong/description)。

2.  在页面左上角，选择实例所在地域。

3.  在实例列表名称页面，单击目标实例名称。

4.  在左侧导航栏中，单击**诊断与优化** \> **SQL审计与分析**。

5.  根据页面提示，授权DRDS使用AliyunDRDSDefaultRole角色访问日志服务。

    **说明：**

    -   该操作仅在首次配置时需要，且需要由主账号进行授权。
    -   如果您使用的是RAM用户，该RAM用户需具备相关权限。更多信息，请参见[RAM用户授权](/intl.zh-CN/数据采集/云产品日志采集/云产品日志通用操作.md)。
    -   请勿取消授权或删除RAM角色，否则将导致DRDS SQL审计日志无法正常推送到日志服务。
6.  开启SQL审计与分析功能。

    1.  选择目标数据库，打开数据库状态栏或日志状态栏中的功能开关。

        ![开启审计](https://static-aliyun-doc.oss-accelerate.aliyuncs.com/assets/img/zh-CN/5930559951/p21186.png)

    2.  导入历史数据。

        默认情况下，只推送开启SQL审计与分析功能之后产生的日志到日志服务。如果您要分析未开启SQL审计与分析功能前的日志，可在需要您配置日志存储时间对话框中，打开**是否导入历史数据**的功能开关并选择**回溯开始时间**和**回溯结束时间**，导入历史数据。最大支持导入七天的历史数据。

        您可以在控制台右上角的任务进度中查看日志导入的进度，导入过程需一定的时间，请耐心等待。

        ![导入历史数据](https://static-aliyun-doc.oss-accelerate.aliyuncs.com/assets/img/zh-CN/5930559951/p21243.png)

    3.  单击**启用**。


日志服务采集到DRDS SQL审计日志后，您可以执行查询分析、下载、投递、加工、创建告警等操作。更多信息，请参见[云产品日志通用操作](/intl.zh-CN/数据采集/云产品日志采集/云产品日志通用操作.md)。

